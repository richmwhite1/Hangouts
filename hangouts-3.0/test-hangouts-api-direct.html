<!DOCTYPE html>
<html>
<head>
  <title>Test Hangouts API Direct</title>
  <script src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
</head>
<body>
  <h1>Test Hangouts API Direct</h1>
  <button id="signInBtn">Sign In with Clerk</button>
  <button id="testBtn" disabled>Test Hangouts API</button>
  <div id="output"></div>

  <script>
    const clerkPubKey = 'pk_test_Zm9uZC1wZWxpY2FuLTQ2LmNsZXJrLmFjY291bnRzLmRldiQ';
    
    const clerk = new window.Clerk(clerkPubKey);
    
    clerk.load().then(() => {
      console.log('Clerk loaded');
      
      if (clerk.user) {
        document.getElementById('testBtn').disabled = false;
        document.getElementById('output').innerHTML = `<p>Signed in as: ${clerk.user.primaryEmailAddress?.emailAddress}</p>`;
      }
      
      document.getElementById('signInBtn').addEventListener('click', async () => {
        try {
          await clerk.openSignIn();
        } catch (error) {
          console.error('Sign in error:', error);
        }
      });
      
      document.getElementById('testBtn').addEventListener('click', async () => {
        try {
          const token = await clerk.session.getToken();
          console.log('Token retrieved:', token ? 'YES' : 'NO');
          console.log('Token length:', token?.length || 0);
          
          // Test the exact same data the frontend sends
          const testData = {
            title: 'Test API Hangout ' + Date.now(),
            description: 'This is a test hangout created via API test',
            privacyLevel: 'PUBLIC',
            type: 'multi_option',
            participants: [],
            options: [
              {
                id: 'opt1',
                title: 'Option 1',
                description: 'First option',
                location: 'Location 1',
                dateTime: new Date().toISOString(),
                price: 0
              },
              {
                id: 'opt2',
                title: 'Option 2',
                description: 'Second option',
                location: 'Location 2',
                dateTime: new Date().toISOString(),
                price: 0
              }
            ]
          };
          
          console.log('Sending test data:', testData);
          
          const response = await fetch('http://localhost:3000/api/hangouts', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(testData)
          });
          
          const data = await response.json();
          console.log('Response status:', response.status);
          console.log('Response data:', data);
          
          if (response.ok) {
            document.getElementById('output').innerHTML += `<p style="color: green;">SUCCESS! Hangout created: ${data.data.id}</p>`;
          } else {
            document.getElementById('output').innerHTML += `<p style="color: red;">ERROR: ${JSON.stringify(data, null, 2)}</p>`;
          }
        } catch (error) {
          console.error('Error:', error);
          document.getElementById('output').innerHTML += `<p style="color: red;">EXCEPTION: ${error.message}</p>`;
        }
      });
    });
  </script>
</body>
</html>
