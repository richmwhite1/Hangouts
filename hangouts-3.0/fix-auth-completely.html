<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Authentication Fix</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .status { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: bold; }
        .success { background-color: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 2px solid #ffeaa7; }
        button { background-color: #007bff; color: white; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; margin: 10px; }
        button:hover { background-color: #0056b3; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 2px solid #bee5eb; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .code { background-color: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; }
        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background-color: #f8f9fa; }
    </style>
</head>
<body>
    <h1>üîß Complete Authentication Fix</h1>
    
    <div class="warning">
        <strong>‚ö†Ô∏è Problem Identified:</strong> The frontend is still using an invalid authentication token that doesn't exist in the database. This is causing both hangout creation and event creation to fail with "Foreign key constraint violated" errors.
    </div>
    
    <div class="info">
        <strong>üîç Current Situation:</strong>
        <ul>
            <li><strong>Invalid Token User ID:</strong> <span class="code">cmfxfsg530000jpvtkb1aawyv</span> (doesn't exist in database)</li>
            <li><strong>Valid Token User ID:</strong> <span class="code">cmfyi6rmm0000jp4yv9r4nq8c</span> (exists in database)</li>
            <li><strong>Error:</strong> Foreign key constraint violated when creating content</li>
        </ul>
    </div>
    
    <div class="step">
        <h3>Step 1: Clear All Authentication Data</h3>
        <p>First, let's completely clear any existing authentication data to ensure a clean start.</p>
        <button id="clearAuthButton">üóëÔ∏è Clear All Auth Data</button>
    </div>
    
    <div class="step">
        <h3>Step 2: Set Valid Authentication Token</h3>
        <p>Now, let's set the correct authentication token that matches a user in the database.</p>
        <button id="setValidTokenButton">üîë Set Valid Token</button>
    </div>
    
    <div class="step">
        <h3>Step 3: Verify Authentication</h3>
        <p>Let's verify that the authentication is working correctly.</p>
        <button id="verifyAuthButton">‚úÖ Verify Authentication</button>
    </div>
    
    <div id="status"></div>
    
    <div class="info">
        <strong>üì± Next Steps After Fixing:</strong>
        <ol>
            <li>Go back to your main app at <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
            <li>Refresh the page completely (Ctrl+F5 or Cmd+Shift+R)</li>
            <li>Try creating both hangouts and events - they should work now!</li>
        </ol>
    </div>

    <script>
        // Valid user data that actually exists in the database
        const validToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWZ5aTZybW0wMDAwanA0eXY5cjRucThjIiwiZW1haWwiOiJrYXJsQGVtYWlsLmNvbSIsInVzZXJuYW1lIjoia2FybCIsImlhdCI6MTc1ODc0OTc0MywiZXhwIjoxNzU5MzU0NTQzfQ.2Q3vFE250O6shvjjlDuF9mRHPZW_7du5xzLXsBUmGDM";
        const validUser = {
            "id": "cmfyi6rmm0000jp4yv9r4nq8c",
            "email": "karl@email.com", 
            "username": "karl",
            "name": "Karl Test User"
        };

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        document.getElementById('clearAuthButton').addEventListener('click', () => {
            try {
                // Clear all possible auth-related keys
                const keysToRemove = [
                    'auth_token', 'auth_user', 'token', 'user', 
                    'access_token', 'refresh_token', 'jwt_token'
                ];
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                    sessionStorage.removeItem(key);
                });
                
                updateStatus('‚úÖ All authentication data cleared successfully!', 'success');
                console.log('‚úÖ Cleared all authentication data');
            } catch (e) {
                updateStatus('‚ùå Error clearing auth data: ' + e.message, 'error');
                console.error('‚ùå Error clearing auth data:', e);
            }
        });

        document.getElementById('setValidTokenButton').addEventListener('click', () => {
            try {
                // Set the correct auth data
                localStorage.setItem('auth_token', validToken);
                localStorage.setItem('auth_user', JSON.stringify(validUser));
                
                updateStatus('‚úÖ Valid authentication token set successfully!<br><br><strong>User ID:</strong> ' + validUser.id + '<br><strong>Username:</strong> ' + validUser.username, 'success');
                
                console.log('‚úÖ Set valid authentication token:');
                console.log('   User ID:', validUser.id);
                console.log('   Username:', validUser.username);
                console.log('   Email:', validUser.email);
                
            } catch (e) {
                updateStatus('‚ùå Error setting token: ' + e.message, 'error');
                console.error('‚ùå Error setting token:', e);
            }
        });

        document.getElementById('verifyAuthButton').addEventListener('click', () => {
            try {
                const storedToken = localStorage.getItem('auth_token');
                const storedUser = localStorage.getItem('auth_user');
                
                if (!storedToken || !storedUser) {
                    updateStatus('‚ùå No authentication data found. Please set the valid token first.', 'error');
                    return;
                }
                
                const user = JSON.parse(storedUser);
                
                if (user.id === validUser.id && storedToken === validToken) {
                    updateStatus('‚úÖ Authentication verified! Token and user data are correct.<br><br><strong>Ready to create hangouts and events!</strong>', 'success');
                } else {
                    updateStatus('‚ùå Authentication verification failed. Token or user data is incorrect.', 'error');
                }
                
            } catch (e) {
                updateStatus('‚ùå Error verifying authentication: ' + e.message, 'error');
                console.error('‚ùå Error verifying authentication:', e);
            }
        });
    </script>
</body>
</html>


























