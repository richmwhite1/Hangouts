<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Hangouts Display</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #000; 
            color: #fff; 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 5px; 
            background: #111;
        }
        .success { 
            background-color: #0d4f0d; 
            border-color: #28a745; 
        }
        .error { 
            background-color: #4f0d0d; 
            border-color: #dc3545; 
        }
        .info { 
            background-color: #0d2d4f; 
            border-color: #007bff; 
        }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            cursor: pointer; 
            background: #ff1493; 
            color: #000; 
            border: none; 
            border-radius: 5px; 
            font-weight: bold;
        }
        button:hover { background: #ff69b4; }
        pre { 
            background: #222; 
            padding: 10px; 
            border-radius: 3px; 
            overflow-x: auto; 
            color: #fff;
        }
        .hangout-tile {
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #222;
        }
        .hangout-image {
            width: 100%;
            height: 200px;
            background: #333;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Hangouts Display</h1>
    
    <div class="test-section info">
        <h2>üìã Test Plan</h2>
        <p>1. Sign in as Karl</p>
        <p>2. Create a hangout</p>
        <p>3. Check if it appears in home feed</p>
        <p>4. Check if it appears in discover page</p>
        <p>5. Verify tile display with images</p>
    </div>

    <div class="test-section">
        <h2>1. Authentication</h2>
        <button onclick="signinKarl()">Sign In Karl</button>
        <div id="auth-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Create Test Hangout</h2>
        <button onclick="createTestHangout()">Create Test Hangout</button>
        <div id="create-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Test Home Feed</h2>
        <button onclick="testHomeFeed()">Fetch Home Feed</button>
        <div id="home-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Test Discover Page</h2>
        <button onclick="testDiscoverPage()">Fetch Discover Page</button>
        <div id="discover-result"></div>
    </div>

    <div class="test-section">
        <h2>5. Test Pages</h2>
        <button onclick="openHomePage()">Open Home Page</button>
        <button onclick="openDiscoverPage()">Open Discover Page</button>
        <div id="page-result"></div>
    </div>

    <script>
        let authToken = null;
        let createdHangoutId = null;

        async function signinKarl() {
            try {
                const response = await fetch('/api/auth/signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'karl@email.com',
                        password: 'Password1!'
                    })
                });

                const data = await response.json();
                if (data.success) {
                    authToken = data.data.token;
                    localStorage.setItem('auth_token', authToken);
                    document.getElementById('auth-result').innerHTML = 
                        `<div class="success">‚úÖ Karl signed in successfully!<br><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                } else {
                    throw new Error(data.error || 'Failed to sign in Karl');
                }
            } catch (error) {
                document.getElementById('auth-result').innerHTML = 
                    `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function createTestHangout() {
            if (!authToken) {
                document.getElementById('create-result').innerHTML = 
                    `<div class="error">‚ùå Please sign in first</div>`;
                return;
            }

            try {
                const response = await fetch('/api/hangouts', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        title: 'Test Hangout for Display',
                        description: 'This hangout should appear in both home feed and discover page',
                        startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                        endTime: new Date(Date.now() + 26 * 60 * 60 * 1000).toISOString(),
                        privacyLevel: 'PUBLIC',
                        type: 'quick_plan',
                        options: [
                            {
                                id: 'test_option_1',
                                title: 'Go to the park',
                                description: 'Enjoy a nice day at the park',
                                location: 'Central Park',
                                dateTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                                price: 0,
                                eventImage: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop'
                            }
                        ]
                    })
                });

                const data = await response.json();
                if (data.success) {
                    createdHangoutId = data.data.id;
                    document.getElementById('create-result').innerHTML = 
                        `<div class="success">‚úÖ Test hangout created!<br>
                        ID: ${createdHangoutId}<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                } else {
                    throw new Error(data.error || 'Failed to create hangout');
                }
            } catch (error) {
                document.getElementById('create-result').innerHTML = 
                    `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testHomeFeed() {
            if (!authToken) {
                document.getElementById('home-result').innerHTML = 
                    `<div class="error">‚ùå Please sign in first</div>`;
                return;
            }

            try {
                const response = await fetch('/api/hangouts', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                if (data.success) {
                    const hangouts = data.data.hangouts || [];
                    document.getElementById('home-result').innerHTML = 
                        `<div class="success">‚úÖ Home feed fetched!<br>
                        Found ${hangouts.length} hangouts<br>
                        ${hangouts.map(h => renderHangoutTile(h)).join('')}
                        <pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                } else {
                    throw new Error(data.error || 'Failed to fetch home feed');
                }
            } catch (error) {
                document.getElementById('home-result').innerHTML = 
                    `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testDiscoverPage() {
            if (!authToken) {
                document.getElementById('discover-result').innerHTML = 
                    `<div class="error">‚ùå Please sign in first</div>`;
                return;
            }

            try {
                const response = await fetch('/api/hangouts?discover=true', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                if (data.success) {
                    const hangouts = data.data.hangouts || [];
                    document.getElementById('discover-result').innerHTML = 
                        `<div class="success">‚úÖ Discover page fetched!<br>
                        Found ${hangouts.length} hangouts<br>
                        ${hangouts.map(h => renderHangoutTile(h)).join('')}
                        <pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                } else {
                    throw new Error(data.error || 'Failed to fetch discover page');
                }
            } catch (error) {
                document.getElementById('discover-result').innerHTML = 
                    `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function renderHangoutTile(hangout) {
            const imageUrl = hangout.image || hangout.options?.[0]?.eventImage || '/placeholder-hangout.png';
            return `
                <div class="hangout-tile">
                    <div class="hangout-image">
                        <img src="${imageUrl}" alt="${hangout.title}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; align-items: center; justify-content: center; color: #666;">
                            üìÖ No Image
                        </div>
                    </div>
                    <h3>${hangout.title}</h3>
                    <p>${hangout.description || 'No description'}</p>
                    <p>üìç ${hangout.location || 'No location'}</p>
                    <p>üë• ${hangout._count?.content_participants || 0} participants</p>
                    <p>üîí ${hangout.privacyLevel}</p>
                </div>
            `;
        }

        function openHomePage() {
            const url = 'http://localhost:3001/';
            document.getElementById('page-result').innerHTML = 
                `<div class="info">üîó <a href="${url}" target="_blank" style="color: #ff1493;">Open Home Page</a><br>URL: ${url}</div>`;
        }

        function openDiscoverPage() {
            const url = 'http://localhost:3001/discover';
            document.getElementById('page-result').innerHTML = 
                `<div class="info">üîó <a href="${url}" target="_blank" style="color: #ff1493;">Open Discover Page</a><br>URL: ${url}</div>`;
        }
    </script>
</body>
</html>
