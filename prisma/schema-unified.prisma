generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                        String                      @id @default(cuid())
  email                     String                      @unique
  username                  String                      @unique
  name                      String
  avatar                    String?
  backgroundImage           String?
  bio                       String?
  location                  String?
  website                   String?
  birthDate                 DateTime?
  password                  String
  role                      UserRole                    @default(USER)
  isActive                  Boolean                     @default(true)
  isVerified                Boolean                     @default(false)
  lastSeen                  DateTime                    @default(now())
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  comments                  comments[]
  content                   content[]
  content_likes             content_likes[]
  content_participants      content_participants[]
  content_reports           content_reports[]
  content_shares            content_shares[]
  receivedFriendRequests    FriendRequest[]             @relation("FriendRequestReceiver")
  sentFriendRequests        FriendRequest[]             @relation("FriendRequestSender")
  friendships               Friendship[]                @relation("UserFriendships")
  friendOf                  Friendship[]                @relation("FriendFriendships")
  message_reads             message_reads[]
  messages                  messages[]
  notificationPreferences   NotificationPreference[]
  notifications             Notification[]
  passwordResetTokens       PasswordResetToken?
  photo_comments            photo_comments[]
  photo_likes               photo_likes[]
  photo_tags                photo_tags[]
  photos                    photos[]
  pollParticipants          PollParticipant[]
  pollVotes                 PollVote[]
  polls                     polls[]
  refreshTokens             RefreshToken[]
  rsvps                     rsvp[]
  securityLogs              SecurityLog[]

  @@index([email])
  @@index([username])
  @@index([isActive])
  @@index([lastSeen])
  @@index([createdAt])
  @@map("users")
}

model FriendRequest {
  id         String              @id @default(cuid())
  senderId   String
  receiverId String
  status     FriendRequestStatus @default(PENDING)
  message    String?
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  sender     User                @relation("FriendRequestSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver   User                @relation("FriendRequestReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
  @@index([status])
  @@map("friend_requests")
}

model Friendship {
  id        String           @id @default(cuid())
  userId    String
  friendId  String
  status    FriendshipStatus @default(ACTIVE)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  friend    User             @relation("FriendFriendships", fields: [friendId], references: [id], onDelete: Cascade)
  user      User             @relation("UserFriendships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, friendId])
  @@index([userId])
  @@index([friendId])
  @@map("friendships")
}

model Notification {
  id          String           @id @default(cuid())
  userId      String
  type        NotificationType
  title       String
  message     String
  data        Json?
  isRead      Boolean          @default(false)
  isEmailSent Boolean          @default(false)
  isPushSent  Boolean          @default(false)
  createdAt   DateTime         @default(now())
  readAt      DateTime?
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationPreference {
  id           String           @id @default(cuid())
  userId       String
  type         NotificationType
  emailEnabled Boolean          @default(true)
  pushEnabled  Boolean          @default(true)
  inAppEnabled Boolean          @default(true)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type])
  @@index([userId])
  @@index([type])
  @@map("notification_preferences")
}

model PollVote {
  id          String   @id @default(cuid())
  pollId      String
  userId      String
  option      String
  voteType    String   @default("SINGLE")
  ranking     Int?
  score       Int?
  weight      Float    @default(1.0)
  isDelegated Boolean  @default(false)
  delegatedTo String?
  isPreferred Boolean  @default(false)
  sentiment   String?
  comment     String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  poll        polls    @relation(fields: [pollId], references: [id], onDelete: Cascade)

  @@unique([pollId, userId, option])
  @@index([pollId])
  @@index([userId])
  @@index([option])
  @@map("poll_votes")
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    String
  tokenId   String   @unique
  expiresAt DateTime
  isRevoked Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([isRevoked])
  @@map("refresh_tokens")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String   @unique
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@map("password_reset_tokens")
}

model SecurityLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  resource  String?
  ipAddress String?
  userAgent String?
  details   Json?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("security_logs")
}

model finalPlan {
  id                String   @id @default(cuid())
  contentId         String
  pollId            String
  title             String
  description       String?
  optionId          String
  optionText        String
  optionDescription String?
  metadata          Json?
  consensusLevel    Float
  totalVotes        Int
  finalizedBy       String
  finalizedAt       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  content           content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users             User     @relation(fields: [finalizedBy], references: [id])

  @@index([contentId])
  @@index([pollId])
  @@index([finalizedBy])
  @@map("final_plans")
}

model rsvp {
  id          String            @id @default(cuid())
  contentId   String
  userId      String
  status      RSVPStatus        @default(PENDING)
  respondedAt DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  content     content           @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users       User              @relation(fields: [userId], references: [id])

  @@unique([contentId, userId])
  @@index([contentId])
  @@index([userId])
  @@index([status])
  @@index([respondedAt])
  @@index([createdAt])
  @@map("rsvps")
}

model comments {
  id             String     @id
  contentId      String
  userId         String
  text           String
  replyToId      String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  content        content    @relation(fields: [contentId], references: [id], onDelete: Cascade)
  comments       comments?  @relation("commentsTocomments", fields: [replyToId], references: [id])
  other_comments comments[] @relation("commentsTocomments")
  users          User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([createdAt])
  @@index([userId])
}

// UNIFIED CONTENT MODEL - Supports both hangouts and events
model content {
  id                   String                 @id
  type                 ContentType
  title                String
  description          String?
  image                String?
  location             String?
  latitude             Float?
  longitude            Float?
  startTime            DateTime?
  endTime              DateTime?
  status               ContentStatus          @default(DRAFT)
  privacyLevel         PrivacyLevel           @default(PRIVATE)
  creatorId            String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  
  // Event-specific fields (unified into content)
  venue                String?
  address              String?
  city                 String?
  state                String?
  zipCode              String?
  priceMin             Float?                 @default(0)
  priceMax             Float?
  currency             String?                @default("USD")
  ticketUrl            String?
  attendeeCount        Int?                   @default(0)
  externalEventId      String?
  source               EventSource?           @default(MANUAL)
  
  // Hangout-specific fields (unified into content)
  maxParticipants      Int?
  weatherEnabled       Boolean?               @default(false)
  
  // Relationships
  comments             comments[]
  users                User                   @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  content_likes        content_likes[]
  content_participants content_participants[]
  content_reports      content_reports[]
  content_shares       content_shares[]
  messages             messages[]
  photos               photos[]
  polls                polls[]
  rsvps                rsvp[]
  finalPlans           finalPlan[]
  eventTags            EventTag[]
  eventImages          EventImage[]
  eventSaves           EventSave[]

  @@index([createdAt])
  @@index([creatorId])
  @@index([privacyLevel])
  @@index([startTime])
  @@index([status])
  @@index([type])
  @@index([venue])
  @@index([city])
  @@index([priceMin])
  @@index([attendeeCount])
}

model content_likes {
  id        String   @id
  contentId String
  userId    String
  createdAt DateTime @default(now())
  content   content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([contentId, userId])
  @@index([contentId])
  @@index([userId])
}

model content_participants {
  id          String          @id
  contentId   String
  userId      String
  role        ParticipantRole @default(MEMBER)
  canEdit     Boolean         @default(false)
  isMandatory Boolean         @default(false)
  isCoHost    Boolean         @default(false)
  invitedAt   DateTime        @default(now())
  joinedAt    DateTime?
  content     content         @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users       User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([contentId, userId])
  @@index([contentId])
  @@index([isMandatory])
  @@index([userId])
}

model content_reports {
  id          String       @id
  contentId   String
  reporterId  String
  reason      String
  description String?
  status      ReportStatus @default(PENDING)
  reviewedBy  String?
  reviewedAt  DateTime?
  createdAt   DateTime     @default(now())
  content     content      @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users       User         @relation(fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([reporterId])
  @@index([status])
}

model content_shares {
  id        String   @id
  contentId String
  userId    String
  message   String?
  createdAt DateTime @default(now())
  content   content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([userId])
}

model message_reads {
  id             String         @id
  messageId      String
  userId         String
  readAt         DateTime       @default(now())
  users          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages       messages       @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@index([messageId])
  @@index([userId])
}

model messages {
  id             String          @id
  contentId      String?
  senderId       String
  text           String
  type           MessageType     @default(TEXT)
  attachments    String
  replyToId      String?
  editedAt       DateTime?
  createdAt      DateTime        @default(now())
  message_reads  message_reads[]
  users          User            @relation(fields: [senderId], references: [id], onDelete: Cascade)
  messages       messages?       @relation("messagesTomessages", fields: [replyToId], references: [id])
  other_messages messages[]      @relation("messagesTomessages")
  content        content?        @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([createdAt])
  @@index([replyToId])
  @@index([senderId])
}

model photo_comments {
  id        String   @id
  photoId   String
  userId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  photos    photos   @relation(fields: [photoId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([photoId])
  @@index([userId])
}

model photo_likes {
  id        String   @id
  photoId   String
  userId    String
  createdAt DateTime @default(now())
  users     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  photos    photos   @relation(fields: [photoId], references: [id], onDelete: Cascade)

  @@unique([photoId, userId])
  @@index([photoId])
  @@index([userId])
}

model photo_tags {
  id        String   @id
  photoId   String
  name      String
  creatorId String
  createdAt DateTime @default(now())
  photos    photos   @relation(fields: [photoId], references: [id], onDelete: Cascade)
  users     User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@unique([photoId, name])
  @@index([creatorId])
  @@index([name])
  @@index([photoId])
}

model photos {
  id                                 String           @id
  creatorId                          String
  contentId                          String?          // Changed from hangoutId to contentId for unified approach
  caption                            String?
  isPublic                           Boolean          @default(false)
  originalUrl                        String
  thumbnailUrl                       String
  smallUrl                           String
  mediumUrl                          String
  largeUrl                           String
  originalWidth                      Int
  originalHeight                     Int
  fileSize                           Int
  mimeType                           String
  createdAt                          DateTime         @default(now())
  updatedAt                          DateTime
  photo_comments                     photo_comments[]
  photo_likes                        photo_likes[]
  photo_tags                         photo_tags[]
  content                            content?         @relation(fields: [contentId], references: [id])
  users                              User             @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([createdAt])
  @@index([creatorId])
  @@index([isPublic])
}

model polls {
  id                  String            @id
  contentId           String            // Changed from hangoutId to contentId for unified approach
  creatorId           String
  title               String
  description         String?
  options             Json
  allowMultiple       Boolean           @default(false)
  isAnonymous         Boolean           @default(false)
  expiresAt           DateTime?
  consensusPercentage Int               @default(70)
  minimumParticipants Int               @default(2)
  consensusType       String            @default("percentage")
  status              String            @default("ACTIVE")
  allowDelegation     Boolean           @default(false)
  allowAbstention     Boolean           @default(true)
  allowAddOptions     Boolean           @default(true)
  isPublic            Boolean           @default(false)
  visibility          PollVisibility    @default(PRIVATE)
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @default(now())
  participants        PollParticipant[]
  votes               PollVote[]
  content             content           @relation(fields: [contentId], references: [id], onDelete: Cascade)
  users               User              @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId])
  @@index([contentId])
  @@index([status])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([visibility])
}

model PollParticipant {
  id           String    @id @default(cuid())
  pollId       String
  userId       String
  status       String    @default("INVITED")
  canVote      Boolean   @default(true)
  canDelegate  Boolean   @default(false)
  delegatedTo  String?
  delegatedBy  String?
  joinedAt     DateTime?
  lastActiveAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  poll         polls     @relation(fields: [pollId], references: [id], onDelete: Cascade)

  @@unique([pollId, userId])
  @@index([pollId])
  @@index([userId])
  @@index([status])
  @@map("poll_participants")
}

// Event-specific models (simplified and unified)
model EventTag {
  id        String   @id @default(cuid())
  contentId String   // Changed from eventId to contentId
  tag       String
  createdAt DateTime @default(now())
  content   content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, tag])
  @@map("event_tags")
}

model EventImage {
  id         String   @id @default(cuid())
  contentId  String   // Changed from eventId to contentId
  imageUrl   String
  orderIndex Int      @default(0)
  createdAt  DateTime @default(now())
  content    content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@map("event_images")
}

model EventSave {
  id        String   @id @default(cuid())
  contentId String   // Changed from eventId to contentId
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  content   content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, userId])
  @@map("event_saves")
}

// Enums
enum FriendRequestStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}

enum FriendshipStatus {
  ACTIVE
  BLOCKED
}

enum PrivacyLevel {
  PRIVATE
  FRIENDS_ONLY
  PUBLIC
}

enum PollVisibility {
  PRIVATE
  FRIENDS
  PUBLIC
}

enum ParticipantRole {
  CREATOR
  ADMIN
  MODERATOR
  MEMBER
  CO_HOST
}

enum RSVPStatus {
  PENDING
  YES
  NO
  MAYBE
}

enum NotificationType {
  FRIEND_REQUEST
  FRIEND_ACCEPTED
  MESSAGE_RECEIVED
  CONTENT_INVITATION
  CONTENT_RSVP
  CONTENT_REMINDER
  CONTENT_UPDATE
  COMMUNITY_INVITATION
  MENTION
  LIKE
  COMMENT
  SHARE
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  LOCATION
  POLL
  SYSTEM
}

enum UserRole {
  USER
  MODERATOR
  ADMIN
  SUPER_ADMIN
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
  DELETED
}

enum ContentType {
  HANGOUT
  EVENT
  COMMUNITY
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

enum EventCategory {
  MUSIC
  SPORTS
  FOOD
  NIGHTLIFE
  ARTS
  OUTDOORS
  TECHNOLOGY
  BUSINESS
  EDUCATION
  HEALTH
  FAMILY
  OTHER
}

enum EventSource {
  MANUAL
  EVENTBRITE
  FACEBOOK
  MEETUP
  OTHER
}











