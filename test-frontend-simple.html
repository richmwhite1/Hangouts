<!DOCTYPE html>
<html>
<head>
    <title>Frontend Test</title>
</head>
<body>
    <h1>Frontend Hangout Creation Test</h1>
    <div id="result"></div>
    
    <script>
        async function testFrontend() {
            try {
                // Step 1: Sign in
                console.log('1️⃣ Signing in...')
                const signInResponse = await fetch('http://localhost:3000/api/auth/signin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'karl@email.com',
                        password: 'Password1!'
                    })
                })
                
                const signInData = await signInResponse.json()
                if (!signInData.success) {
                    throw new Error(`Sign in failed: ${signInData.error}`)
                }
                
                const token = signInData.data.token
                console.log('✅ Sign in successful')

                // Step 2: Get friends
                console.log('2️⃣ Getting friends...')
                const friendsResponse = await fetch('http://localhost:3000/api/friends', {
                    headers: { 'Authorization': `Bearer ${token}` }
                })
                
                const friendsData = await friendsResponse.json()
                if (!friendsData.success) {
                    throw new Error(`Friends API failed: ${friendsData.error}`)
                }
                
                console.log(`✅ Found ${friendsData.data.friends.length} friends`)
                console.log('Friends:', friendsData.data.friends.map(f => ({ id: f.id, name: f.name })))

                // Step 3: Test hangout creation with first friend
                console.log('3️⃣ Creating hangout with friend...')
                const hangoutData = {
                    title: 'Frontend Test Hangout',
                    description: 'Testing from frontend',
                    type: 'quick_plan',
                    options: [{
                        id: 'test_opt',
                        title: 'Test Option',
                        description: 'Test description',
                        location: 'Test Location',
                        dateTime: '2025-01-25T20:00:00Z',
                        price: 10
                    }],
                    participants: [friendsData.data.friends[0].id] // Use first friend
                }

                console.log('Sending data:', JSON.stringify(hangoutData, null, 2))

                const hangoutResponse = await fetch('http://localhost:3000/api/hangouts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(hangoutData)
                })

                const hangoutResult = await hangoutResponse.json()
                
                if (hangoutResult.success) {
                    console.log('✅ Hangout created successfully!')
                    console.log('Hangout ID:', hangoutResult.data.id)
                    console.log('Participants:', hangoutResult.data.content_participants.length)
                    
                    document.getElementById('result').innerHTML = `
                        <h2>✅ SUCCESS!</h2>
                        <p>Hangout created: ${hangoutResult.data.title}</p>
                        <p>ID: ${hangoutResult.data.id}</p>
                        <p>Participants: ${hangoutResult.data.content_participants.length}</p>
                        <p>State: ${hangoutResult.data.state}</p>
                    `
                } else {
                    throw new Error(`Hangout creation failed: ${hangoutResult.error}`)
                }
                
            } catch (error) {
                console.error('❌ Test failed:', error)
                document.getElementById('result').innerHTML = `
                    <h2>❌ FAILED</h2>
                    <p>Error: ${error.message}</p>
                `
            }
        }

        testFrontend();
    </script>
</body>
</html>




